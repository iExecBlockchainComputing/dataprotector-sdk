specVersion: 0.0.5
description: Subgraph for dataProtector smart contract
schema:
  file: ./schema.graphql
dataSources:
  # ============================= Data protector ==============================
  - name: DataProtector
    kind: ethereum/contract
    network: bellecour
    source:
      address: '0x3a4Ab33F3D605e75b6D00A32A0Fa55C3628F6A59'
      abi: DataProtector
      #START_BLOCK_PLACEHOLDER#
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - ProtectedData
        - SchemaEntry
        - Account
      abis:
        - name: DataProtector
          file: ./abis/DataProtector.json
      eventHandlers:
        - event: DatasetSchema(indexed address,string)
          handler: handleDatasetSchema
      file: ./src/dataProtector.ts

  # ============================= Dataset registry ==============================
  - name: DatasetRegistry
    kind: ethereum/contract
    network: bellecour
    source:
      address: '0x799DAa22654128d0C64d5b79eac9283008158730'
      abi: DatasetRegistry
      #START_BLOCK_PLACEHOLDER#
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - ProtectedData
      abis:
        - name: Dataset
          file: node_modules/@iexec/poco/build/contracts/Dataset.json
        - name: DatasetRegistry
          file: node_modules/@iexec/poco/build/contracts/DatasetRegistry.json
      eventHandlers:
        - event: Transfer(indexed address,indexed address,indexed uint256)
          handler: handleTransferDataset
      file: ./src/datasetRegistry.ts

  # ============================= ProtectedDataSharing ==============================
  - name: ProtectedDataSharing
    kind: ethereum/contract
    network: bellecour
    source:
      address: '0x721a0d237a40Ff5Ea40Ad5eb0c8e5101d5aa5856'
      abi: ProtectedDataSharing
      #START_BLOCK_PLACEHOLDER#
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - Account
        - Collection
        - SubscriptionParam
        - CollectionSubscription
        - Rental
        - RentalParam
        - Sale
        - SaleParam
        - Consumption
      abis:
        - name: ProtectedDataSharing
          file: ./abis/ProtectedDataSharing.json
      eventHandlers:
        # ============================= Collection ==============================
        - event: Transfer(indexed address,indexed address,indexed uint256)
          handler: handleTransfer
        - event: ProtectedDataAddedToCollection(uint256,address,address)
          handler: handleProtectedDataAddedToCollection
        - event: ProtectedDataRemovedFromCollection(uint256,address)
          handler: handleProtectedDataRemovedFromCollection
        - event: ProtectedDataConsumed(bytes32,address,uint8)
          handler: handleProtectedDataConsumed
        # ============================= Subscription ==============================
        - event: NewSubscription(uint256,indexed address,uint48)
          handler: handleNewSubscription
        - event: NewSubscriptionParams(uint256,(uint112,uint48))
          handler: handleNewSubscriptionParams
        - event: ProtectedDataAddedForSubscription(uint256,address)
          handler: handleProtectedDataAddedForSubscription
        - event: ProtectedDataRemovedFromSubscription(uint256,address)
          handler: handleProtectedDataRemovedFromSubscription
        # ============================= Renting ==============================
        - event: NewRental(uint256,address,address,uint48)
          handler: handleNewRental
        - event: ProtectedDataAddedForRenting(uint256,address,uint112,uint48)
          handler: handleProtectedDataAddedForRenting
        - event: ProtectedDataRemovedFromRenting(uint256,address)
          handler: handleProtectedDataRemovedFromRenting
        # ============================= Sale==================================
        - event: ProtectedDataSold(uint256,address,address)
          handler: handleProtectedDataSold
        - event: ProtectedDataAddedForSale(uint256,address,uint112)
          handler: handleProtectedDataAddedForSale
        - event: ProtectedDataRemovedFromSale(uint256,address)
          handler: handleProtectedDataRemovedFromSale
      file: ./src/protectedDataSharing.ts
